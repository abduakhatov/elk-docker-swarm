version: "3.7"

services:
  curator:
    image: registry.track.uz/curator:elasticdocker-${ELK_VERSION?latest}
    build:
      context: curator/.
    restart: unless-stopped
    volumes:
      - ./curator/curator.yml:/root/.curator/curator.yml:ro
      - ./curator/actions/:/actions/:ro
      - ./curator/crontab:/etc/crontab:ro
    networks:
      - elastic
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    deploy:
      placement:
        constraints:
          - node.labels.curator == true


  # elastalert:
  #   image: bitsensor/elastalert:latest
  #   restart: unless-stopped
  #   volumes:
  #     - ./tools/elastalert/config/elastalert.yaml:/opt/config/config.yaml
  #     - ./tools/elastalert/config/elastalert-test.yaml:/opt/config/config-test.yaml
  #     - ./tools/elastalert/config/config.json:/opt/config/config.json
  #     - ./tools/elastalert/rules:/opt/elastalert/rules
  #     # - ./tools/elastalert/rule_templates:/opt/elastalert/rule_templates
  #   environment:
  #     ELASTICSEARCH_HOST: ${ELASTICSEARCH_HOST}
  #     ELASTICSEARCH_PORT: ${ELASTICSEARCH_PORT}
  #     ELASTIC_USERNAME: ${ELASTIC_USERNAME}
  #     ELASTIC_PASSWORD: ${ELASTIC_PASSWORD}
  #   ports:
  #     - 3030:3030


networks:
  elastic:
    driver: ${DEFAULT_NETWORK_TYPE-overlay}
